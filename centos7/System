FROM samrhughes/rdbcheckout AS priorcheckout

FROM centos:centos7

# General platform dependencies
RUN yum update -y && yum install -y openssl-devel libcurl-devel wget tar m4 \
    git-core gcc-c++ \
    which make zlib-devel \
    protobuf-devel \
    bzip2 patch \
    rubygems ruby-devel rpm-build \
    libquadmath-devel

# To be removed when we make build-rpm.sh not statically link ssl and curl
RUN yum update -y && yum install -y perl perl-IPC-Cmd perl-Data-Dumper


RUN gem install backports -v 3.21.0 && \
    gem install rexml -v 3.2.3 && \
    gem install ffi -v 1.12.0 && \
    gem install git -v 1.7.0 && \
    gem install fpm -v 1.14.1

RUN mkdir /platform

# We explicitly install packages needed for package building here.
RUN yum update -y && yum install -y libcurl libstdc++ zlib openssl-libs glibc

# Copy cloned and mostly-fetched rethinkdb directory
COPY --from=priorcheckout /rdb /platform
